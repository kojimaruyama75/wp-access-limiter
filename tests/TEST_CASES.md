# テストケース設計書

## テスト環境セットアップ

### 前提条件
- WordPress テスト環境
- PHP 7.4以上
- MySQL/MariaDB
- 複数ユーザーアカウント（テスト用）

### テストデータ準備
- 管理者アカウント: `admin`
- 一般ユーザーアカウント: `user1`, `user2`, `user3`
- エディターアカウント: `editor1`

---

## 基本機能テスト

### TC001: プラグイン有効化テスト
**目的**: プラグインが正常に有効化されることを確認

**手順**:
1. プラグインファイルを配置
2. 管理画面からプラグインを有効化
3. データベースにテーブルが作成されることを確認
4. 設定ページが表示されることを確認

**期待結果**:
- `wp_access_limiter_sessions` テーブルが作成される
- 「設定」>「アクセス制限」メニューが表示される
- デフォルト設定値が正しく設定される

### TC002: 基本設定変更テスト
**目的**: 設定画面での各種設定変更が正常に動作することを確認

**手順**:
1. 設定画面にアクセス
2. 最大ユーザー数を「3」に変更
3. 管理者除外のチェックを外す
4. メッセージを変更
5. 設定を保存

**期待結果**:
- 各設定値が正しく保存される
- 設定変更後の値が画面に反映される

---

## アクセス制限テスト

### TC010: 上限内ログインテスト
**目的**: 上限内でのログインが正常に動作することを確認

**テスト条件**:
- 最大ユーザー数: 2
- 管理者除外: 有効

**手順**:
1. user1でログイン
2. user2でログイン
3. 両方のセッションが有効であることを確認

**期待結果**:
- 両ユーザーともログイン成功
- アクティブユーザー一覧に2名表示
- セッション情報がDBに正しく記録

### TC011: 上限超過ログイン拒否テスト
**目的**: 上限を超えた場合のアクセス拒否が正常に動作することを確認

**テスト条件**:
- 最大ユーザー数: 2
- 既存ログイン: user1, user2

**手順**:
1. user3でログインを試行
2. アクセス拒否メッセージの確認

**期待結果**:
- user3のログインが拒否される
- 設定したメッセージが表示される
- アクティブユーザー数は2のまま

### TC012: 管理者除外テスト
**目的**: 管理者除外設定が正常に動作することを確認

**テスト条件**:
- 最大ユーザー数: 2
- 管理者除外: 有効
- 既存ログイン: user1, user2

**手順**:
1. adminユーザーでログイン
2. adminユーザーのセッション状況確認

**期待結果**:
- adminユーザーのログイン成功
- アクティブユーザー一覧に3名表示
- 実質制限対象は2名のまま

---

## セッション管理テスト

### TC020: 同一ユーザー再ログインテスト
**目的**: 同一ユーザーの再ログイン時の動作確認

**手順**:
1. user1でログイン
2. 別ブラウザでuser1で再ログイン
3. セッション状況の確認

**期待結果**:
- 既存セッションが更新される
- セッション数は増加しない
- 最新の情報（IP、ユーザーエージェント）で更新

### TC021: セッションタイムアウトテスト
**目的**: 30分タイムアウトの動作確認

**手順**:
1. user1でログイン
2. 30分間放置（または時刻を手動変更）
3. 管理画面アクセスまたはクリーンアップ実行
4. セッション状況確認

**期待結果**:
- 期限切れセッションが自動削除される
- アクティブユーザー一覧から除外される

### TC022: 手動切断テスト
**目的**: 管理画面からの手動切断機能確認

**手順**:
1. 複数ユーザーでログイン
2. 管理者が設定画面にアクセス
3. 特定ユーザーの「切断」ボタンをクリック
4. セッション状況確認

**期待結果**:
- 対象ユーザーのセッションが削除される
- アクティブユーザー一覧から即座に除外
- 対象ユーザーは次回アクセス時に再ログインが必要

---

## エラーケーステスト

### TC030: データベースエラーテスト
**目的**: DB接続エラー時の動作確認

**手順**:
1. データベーステーブルを一時的に削除またはリネーム
2. ログインを試行
3. エラー時の動作確認

**期待結果**:
- 適切なエラーハンドリング
- システムクラッシュしない
- エラーメッセージの表示

### TC031: セッションID重複テスト
**目的**: セッションID重複時の動作確認

**手順**:
1. 同一セッションIDを持つレコードを手動作成
2. ログイン試行
3. 動作確認

**期待結果**:
- 適切に処理される
- データ整合性が保たれる

---

## パフォーマンステスト

### TC040: 大量セッションテスト
**目的**: 大量のセッションデータでの性能確認

**手順**:
1. ダミーセッションデータを大量作成（1000件）
2. ログイン処理の実行
3. レスポンス時間測定

**期待結果**:
- 許容範囲内のレスポンス時間
- メモリ使用量の確認

### TC041: 同時アクセステスト
**目的**: 複数ユーザーの同時アクセス時の動作確認

**手順**:
1. 複数ブラウザで同時にログイン試行
2. データ整合性の確認

**期待結果**:
- 上限制御が正しく機能
- データの競合状態が発生しない

---

## UI/UXテスト

### TC050: 設定画面UIテスト
**目的**: 設定画面の使いやすさ確認

**手順**:
1. 設定画面の表示確認
2. 各項目の入力テスト
3. リアルタイム更新機能テスト

**期待結果**:
- 直感的に操作できる
- Ajax機能が正常動作
- エラー表示が適切

### TC051: レスポンシブ対応テスト
**目的**: 様々な画面サイズでの表示確認

**手順**:
1. PC、タブレット、スマートフォンでの表示確認
2. 設定画面の操作性確認

**期待結果**:
- 各デバイスで適切に表示
- 操作に支障なし

---

## 自動テスト実装予定

### 単体テスト (PHPUnit)
- [ ] `check_login_limits()` メソッド
- [ ] `get_active_sessions()` メソッド  
- [ ] `cleanup_expired_sessions()` メソッド
- [ ] `validate_options()` メソッド

### 統合テスト
- [ ] プラグイン有効化/無効化処理
- [ ] 設定保存処理
- [ ] Ajax処理全般

### 負荷テスト
- [ ] 大量セッション時の性能測定
- [ ] 同時アクセス数増加時の動作確認

---

## テスト実行環境

### 推奨環境
- **OS**: Ubuntu 20.04+ / macOS / Windows 10+
- **PHP**: 7.4, 8.0, 8.1, 8.2
- **WordPress**: 5.8, 6.0, 6.1, 6.2
- **DB**: MySQL 5.7+ / MariaDB 10.3+
- **Webサーバー**: Apache 2.4+ / Nginx 1.18+

### CI/CD対応
- GitHub Actions による自動テスト実行
- 複数PHP/WPバージョンでのマトリックステスト
- コードカバレッジ測定

---

**注意**: 本テストケースはDevin連携時に詳細化・自動化予定です。
